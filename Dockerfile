# Usa la imagen base de Rust
FROM rust:latest

# Instala pkg-config, libsodium, nmap y dependencias de Metasploit
RUN apt-get update && \
    apt-get install -y \
    pkg-config \
    libsodium-dev \
    nmap \
    postgresql \
    libsqlite3-dev \
    ruby-full \
    build-essential \
    zlib1g-dev \
    libreadline-dev \
    libpq-dev \
    libpcap-dev \
    git \
    curl && \
    rm -rf /var/lib/apt/lists/*

# Clona el repositorio de Metasploit Framework
RUN git clone https://github.com/rapid7/metasploit-framework.git /usr/local/src/metasploit-framework

# Cambia el directorio de trabajo a Metasploit Framework
WORKDIR /usr/local/src/metasploit-framework

# Instala las dependencias de Metasploit
RUN gem install bundler && \
    bundle install

# Regresa al directorio de trabajo principal
WORKDIR /usr/src/pentesting

# Copia los archivos de configuración del proyecto
COPY Cargo.toml ./ 

# Copia el código fuente
COPY . .

# Compila el proyecto de Rust
RUN cargo build --release

# Define el comando por defecto para Metasploit
CMD ["./target/release/pentesting"]
